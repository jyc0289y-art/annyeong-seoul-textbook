# 보안 검토 결과보고서

**검토일시**: 2026-03-01 01:00 (KST)
**검토 범위**: 교재 PDF 노출 여부 전면 검토 (9개 항목)

---

## 종합 판정

| 위험도 | 항목 수 | 설명 |
|--------|---------|------|
| ⛔ 치명적 | **1건** | Git dangling object에서 원본 PDF 추출 가능 |
| ✅ 안전 | 8건 | 나머지 모든 항목 통과 |

---

## 검사 결과 상세

### ✅ 1. 원본 PDF 직접 URL 접근 — 안전

11권 전체 + 경로 변형 공격 모두 **HTTP 404** 반환.

```
hangul.pdf → 404    beginner.pdf → 404    inter1.pdf → 404
inter2.pdf → 404    inter3.pdf → 404      adv1.pdf → 404
adv2.pdf → 404      adv3.pdf → 404        spinA.pdf → 404
spinB.pdf → 404     spinC.pdf → 404
```

경로 변형 공격 테스트 (대소문자, 이중 슬래시, 디렉토리 탐색 등):
```
pdfs//hangul.pdf → 404     PDFS/hangul.pdf → 404
Pdfs/Hangul.pdf → 404      pdfs/hangul.PDF → 404
pdfs/ (디렉토리 리스팅) → 404
```

**결론**: GitHub Pages 배포물에 원본 PDF가 존재하지 않음.

---

### ⛔ 2. Git 히스토리에서 원본 PDF 추출 — 취약

**Force push 후에도 이전 커밋의 Git blob 객체가 GitHub API로 접근 가능!**

```
검증 과정:
1. 이전 커밋 SHA (3c7b3dd) → GitHub API로 접근 가능 ✓
2. 커밋의 트리 (c2b2d35) → 11개 PDF 파일 경로+SHA 노출 ✓
3. blob SHA (d2c6952...) → base64 인코딩된 PDF 데이터 반환 ✓
4. base64 디코딩 → %PDF-1.7 (원본 PDF 완벽 복원 가능) ⛔
```

**공격 방법** (기술 지식이 있는 사람이라면):
```bash
# 1단계: 이전 커밋 찾기
curl https://api.github.com/repos/jyc0289y-art/annyeong-seoul-textbook/events

# 2단계: 트리에서 PDF blob SHA 확인
curl https://api.github.com/repos/.../git/trees/{tree_sha}?recursive=1

# 3단계: blob 다운로드 + base64 디코딩
curl https://api.github.com/repos/.../git/blobs/{blob_sha} | base64 -d > output.pdf
```

**원인**: GitHub는 force push로 브랜치에서 제거된 커밋도 즉시 삭제하지 않음.
"dangling object"로 남아있다가 GC(가비지 컬렉션)가 실행될 때 삭제되는데,
이 기간이 수 시간~수일 소요될 수 있음.

**해결 방법**: **레포 자체를 완전히 삭제**하는 것만이 유일한 해결책.

---

### ✅ 3. 암호화 파일(.enc) 복호화 불가 — 안전

.enc 파일의 바이너리 헤더를 검사한 결과, PDF 시그니처(%PDF-)가 없음.
AES-256-GCM으로 정상 암호화됨.

```
hangul.enc  → 23 c6 42 fc 44 92 ff 73 ... (암호화 바이너리) ✅
beginner.enc → 72 6d cc 2c b6 87 30 a1 ... (암호화 바이너리) ✅
inter1.enc  → 4c 7d c5 c1 70 76 76 71 ... (암호화 바이너리) ✅
```

복호화 키(`scripts/keys.json`) 없이는 원본 PDF 복원 불가능.

---

### ✅ 4. 미리보기 PDF 페이지 수 — 안전

11권 모두 정확히 **3페이지**만 포함.

```
hangul-preview.pdf → 3페이지 ✅    beginner-preview.pdf → 3페이지 ✅
inter1-preview.pdf → 3페이지 ✅    inter2-preview.pdf → 3페이지 ✅
inter3-preview.pdf → 3페이지 ✅    adv1-preview.pdf → 3페이지 ✅
adv2-preview.pdf → 3페이지 ✅      adv3-preview.pdf → 3페이지 ✅
spinA-preview.pdf → 3페이지 ✅     spinB-preview.pdf → 3페이지 ✅
spinC-preview.pdf → 3페이지 ✅
```

---

### ✅ 5. 소스 코드 비밀 노출 — 안전

| 검사 항목 | 결과 |
|-----------|------|
| keys.json이 Git에 포함? | ✅ 미포함 (.gitignore) |
| 소스코드에 하드코딩된 암호화 키? | ✅ 없음 (11개 키 패턴 전수 검색) |
| demo-keys.json 잔존? | ✅ 없음 (이전에 삭제됨) |
| .env 파일? | ✅ 없음 |

---

### ⛔ 6. GitHub API로 이전 커밋 접근 — 취약 (항목 2와 동일)

| 접근 방법 | 결과 |
|-----------|------|
| 현재 커밋 수 | 1개 (클린 커밋) |
| 이전 커밋 SHA 직접 접근 | ⛔ 접근 가능 (200) |
| 이전 커밋 트리 → PDF 목록 | ⛔ 11개 PDF SHA 노출 |
| blob SHA → PDF 다운로드 | ⛔ 비인증 상태에서도 200 |

---

### ✅ 7. 검색 엔진 / 웹 아카이브 — 안전

| 검사 항목 | 결과 |
|-----------|------|
| Wayback Machine 스냅샷 | ✅ 없음 |
| Google 인덱싱 | ✅ PDF URL 인덱싱 없음 |
| robots.txt | ⚠️ 미설정 (404) — 권장: 추가 |

---

### ✅ 8. 배포 사이트 디렉토리 구조 — 안전

| 파일/경로 | HTTP | 판정 |
|-----------|------|------|
| index.html | 200 | ✅ 정상 (진입점) |
| scripts/keys.json | 404 | ✅ 차단됨 |
| scripts/encrypt-pdfs.js | 404 | ✅ 차단됨 |
| .env | 404 | ✅ 차단됨 |
| .git/config | 404 | ✅ 차단됨 |
| package.json | 404 | ✅ 차단됨 |
| node_modules/ | 404 | ✅ 차단됨 |

Vite 빌드 결과물만 배포되므로 소스 파일은 노출되지 않음.

---

## ⛔ 필수 조치사항

### 즉시 필요: 레포 완전 삭제 후 재생성

현재 상태에서 **기술 지식이 있는 사람이 GitHub API로 원본 PDF를 추출할 수 있습니다.**

실행 절차:
1. **브라우저에서 GitHub 레포 삭제**
   - https://github.com/jyc0289y-art/annyeong-seoul-textbook/settings
   - Danger Zone → Delete this repository
   - ⚠️ 이메일 인증 코드 필요 (j******@gmail.com 확인)

2. **삭제 확인 후 새 레포 생성** (터미널에서):
   ```bash
   cd annyeong-seoul-textbook
   gh repo create annyeong-seoul-textbook --public --source . --push
   ```

3. **GitHub Pages 재활성화**:
   ```bash
   gh api repos/jyc0289y-art/annyeong-seoul-textbook/pages \
     -X POST -f source.branch=main -f source.path="/" \
     -f build_type="workflow"
   ```

이 절차를 완료하면 이전 커밋의 dangling object가 완전히 사라져
**어떤 방법으로도 원본 PDF에 접근할 수 없게 됩니다.**

---

## 위험도 평가

### 현재 위험도: ★★☆☆☆ (낮음~중간)

**낮게 평가한 이유:**
- 공격자가 이전 커밋 SHA를 알아야 함 (레포 이벤트 로그에서 추출 가능하지만, 알려져 있지 않음)
- GitHub Events API는 최근 90일 이벤트만 제공
- 비인증 API 요청은 시간당 60회로 제한됨
- 레포 존재를 아는 사람이 현재 없음 (traffic 0)
- GitHub GC가 실행되면 자동 정리될 수 있음 (불확실한 시간)

**높게 평가해야 하는 이유:**
- Public 레포이므로 누구나 API 접근 가능
- base64 디코딩만으로 원본 PDF 완벽 복원 가능
- 11권 전체의 blob SHA가 한 번에 노출됨

### 레포 삭제 후 위험도: ★☆☆☆☆ (매우 낮음)

---

## 참고: 보안 체크리스트 요약

| # | 검사 항목 | 결과 | 비고 |
|---|----------|------|------|
| 1 | 원본 PDF URL 직접 접근 (11권) | ✅ 안전 | 전체 404 |
| 2 | Git dangling object 접근 | ⛔ 취약 | 레포 삭제로 해결 |
| 3 | .enc 파일 암호화 상태 | ✅ 안전 | AES-256-GCM 정상 |
| 4 | 미리보기 PDF 페이지 제한 | ✅ 안전 | 11권 모두 3페이지 |
| 5 | 소스코드 비밀 노출 | ✅ 안전 | 키/비밀 없음 |
| 6 | 이전 커밋 API 접근 | ⛔ 취약 | 항목 2와 동일 |
| 7 | 검색엔진/아카이브 캐시 | ✅ 안전 | 인덱싱 없음 |
| 8 | 배포 사이트 파일 노출 | ✅ 안전 | 빌드 결과만 배포 |

**결론: 레포를 삭제하고 재생성하면 모든 취약점이 해소됩니다.**
